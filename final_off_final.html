<style>
body {margin:0;}
</style>
<head><title>HILLS of PERIL</title></head>
<body onload="resize_canvas()" onresize="resize_canvas()">
     <script type="text/javascript">
           function resize_canvas()
		   {
                canvas2 = document.getElementById("canvasOne");
                canvas2.width  = window.innerWidth;
                canvas2.height = window.innerHeight;
				context.fillStyle = '#ff0000';
                context.fillRect(0, 0, canvasOne.width, canvasOne.height);
			}
       </script>
	    <div id="score" style="position:absolute; z-index:2;">red hills</div>
        <canvas id="canvasOne" >
         Your browser does not support the HTML 5 Canvas.
         </canvas><div style="position:absolute; z-index:2; left:5px; bottom:5px;color:white;">Designed by Kamal Singh at SNA Power</div>


   </body>
<script type="text/javascript" src="Box2dWeb-2.1.a.3.js"></script>
<script type="text/javascript">

function  drawScreen ()
 {
	var gameover=newBox.GetAngle();
	if(gameover<=-1.4||gameover>=1.5)
		{
		window.location.href = "ksd2.html";
		}
    world.Step(1 / 60, 10,10);
	world.DrawDebugData();
	world.ClearForces();
//Background  
		context.save();
		context.moveTo(-500,0);	
		context.lineTo(55000,0 );
		context.lineTo(55000, canvasOne.height);	
		context.lineTo(-500,canvasOne.height); 
		context.lineTo(-500,0); 
		context.strokeStyle = '#000000';
		context.fillStyle = '#82CAFA';
		context.fill();
		context.stroke();
		context.restore();
//mountains	
		var as=10;	
		context.save();
		context.beginPath();
		var dix=newwall1.GetPosition();
		context.translate(dix.x*SCALE,dix.y*SCALE);
		context.moveTo(xarr1[0]*SCALE,canvasOne.height);
		for(var i=1;i<=totlines-1;i++)
		context.lineTo(xarr1[i]*SCALE, yarr1[i]*SCALE);
		context.lineTo(xarr1[totlines]*SCALE,canvasOne.height);
		context.lineTo(-1.9*SCALE, canvasOne.height);
		context.strokeStyle = '#8b8989';
		context.lineWidth = 15;
		context.stroke();
		context.clip();
		context.beginPath();
		
		for(var i=0;i<=28;i++)
		{
			context.drawImage(bg,as,200);
			as+=400; 
		}
		   context.closePath();
		  context.restore();
//2nd mount.
        as=10;
		context.save();
		context.beginPath();
		var chx=newwall0.GetPosition();
		context.translate(chx.x*SCALE,chx.y*SCALE);
		context.moveTo(xarr2[0]*SCALE,canvasOne.height);
		for(var i=1;i<=totlines-1;i++)
		context.lineTo(xarr2[i]*SCALE, yarr2[i]*SCALE);
		context.lineTo(xarr2[totlines]*SCALE,canvasOne.height);
		context.lineTo(-1.9*SCALE, canvasOne.height);
		context.strokeStyle = '#8b8989';
		context.lineWidth = 15;
		context.stroke();
		context.clip();
		context.beginPath();
		
		for(var i=0;i<=28;i++)
		   { 
	       context.drawImage(bg1,as,0);
		   as+=400;
		   }
		   context.closePath();
		  context.restore();
//3rd
		for(var ti=0;ti<path;ti++)
		   {
		   var dis=newwall2[ti].GetPosition(); 
		   bs=10;
		   context.save();
		   context.beginPath();
		   context.translate(dis.x*SCALE,dis.y*SCALE);
		   context.moveTo(xarr3[0]*SCALE, canvasOne.height);
		   for(var i=1;i<=totlines2-1;i++)
		   context.lineTo(xarr3[i]*SCALE, yarr3[i]*SCALE);
		   context.lineTo(xarr3[totlines2]*SCALE,canvasOne.height);
		   context.lineTo(xarr3[0]*SCALE,canvasOne.height);
		   context.strokeStyle = '#8b8989';
		   context.lineWidth = 15;
		   context.stroke();
		   context.clip();
		   context.beginPath();
		   for(var i=0;i<=28;i++)
		   { 
	       context.drawImage(bg1,bs,0);
		   bs+=400;
		   }
		   context.restore();
		}		
//that bridge..		
            for(var i=0;i<58;i++)
			{
			var position = newBox3[i].GetPosition();
			context.save();
            context.translate(position.x * SCALE+18,position.y *SCALE+18);
            context.drawImage(cul,-27,-27);   				   
            context.restore();
			}
		for(var ti=0;ti<path;ti++)
			{
				for(var i=0;i<58;i++)
				{
					context.save();
					var drax=newBox31[ti][i].GetPosition();
					context.translate(drax.x* SCALE+18,drax.y*SCALE+18);
					context.drawImage(cul,-27,-27);   				   
					context.restore();
					//alert(redrax[i].x+"   "+drax.x);
	            }
			}				
			
//chassis 
			var position = newBox.GetPosition();
			context.save();
            context.translate(position.x * SCALE,position.y *SCALE);
            context.rotate(newBox.GetAngle());
            context.drawImage(img2,-75,-45);
            context.restore();
//rearwheel					   
			var position = newBall.GetPosition();
            context.save();
            context.translate(position.x * SCALE+2,position.y *SCALE);
			context.rotate(newBall.GetAngle());
            context.drawImage(img3,-27,-27);
            context.restore();
//frontwheel

            var position = newBall2.GetPosition();        
			context.save();
            context.translate(position.x * SCALE,position.y *SCALE);
			context.rotate(newBall2.GetAngle());
            context.drawImage(img3,-27,-27);			   
			context.restore();
//random stones
			for(var i=0;i<40;i++)
			{
            var position = newBall3[i].GetPosition();
            context.save();
            context.translate(position.x * SCALE+18,position.y *SCALE+18);
            context.drawImage(img4,-27,-27);   				   
            context.restore();
			}
			 

//score
			var spd = newBox.GetPosition();
			if(typeof(Storage)!=="undefined")
			{
				if (localStorage.highscore)
				{  
					if(localStorage.highscore<spd.x)
					localStorage.highscore=spd.x
					}
				else
				{
					localStorage.highscore=1;
				}
				document.getElementById('score').innerHTML="YOU JUST TRAVELLED"+"      "+Math.floor(spd.x)+"m"+"    ,   "+Math.floor(localStorage.highscore)+"m"+"  (highest)";
			}
			else
			{
				document.getElementById("score").innerHTML="Sorry, your browser does not support web storage...";
			} 
//draw adaptive			
			var post= newBox.GetPosition();
			if(post.x>max)
					{
						max+=372.3;
						init2();					
					}	
        			
        context.setTransform(1, 0, 0, 1, 0, 0);
		context.drawImage(gas,canvasOne.width-200,canvasOne.height-130);  
		context.drawImage(brake,70,canvasOne.height-130);

		window.addEventListener("mousedown",keyon,true);
		window.addEventListener("mouseup",keyoff,true);
		function keyon(e)
		{ 
			if(e.pageX<(canvasOne.width/2))
			{  
				brakeon=true;
			}
			else
			{
				gason=true;	
			}
		}
		function keyoff(e)
		{ 
			brakeon=false;
			gason=false;	
		}
//console.log(gason);
  		if(brakeon)
		{  	
			
			newBall.ApplyTorque(-sp);
		}
		if(gason)
		{
			
			newBall.ApplyTorque(sp);
		}
					

 }
			theCanvas = document.getElementById('canvasOne');
			var context = theCanvas.getContext('2d');
      	   
			var   b2Vec2 = Box2D.Common.Math.b2Vec2;
		    var   b2BodyDef = Box2D.Dynamics.b2BodyDef;
            var   b2Body = Box2D.Dynamics.b2Body;
			var   b2FixtureDef = Box2D.Dynamics.b2FixtureDef;
            var   b2World = Box2D.Dynamics.b2World;
            var   b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape;
            var   b2CircleShape = Box2D.Collision.Shapes.b2CircleShape;
			var   b2RevoluteJointDef = Box2D.Dynamics.Joints.b2RevoluteJointDef;
            var   b2DebugDraw = Box2D.Dynamics.b2DebugDraw;
          
		var world = new b2World(new b2Vec2(0,40),true);
		
        var ballDef = new b2BodyDef;var ballDef2 = new b2BodyDef;
		var xpos = 3.9;var ypos = 8.3;var xpos1= 7.5;var ypos1= 8.3;var size = .8;var bxpos = 5.5;var bypos = 7.3;
		var dat=0;var chck=150;var hest=2000;var path=1;var max=1150;var pre=0;
		
     	var bool1=false;var bool2=false;var bool3=false;var bool4=false;var brakeon=false;var gason=false;
		var sp=10000;		
		var Height = .5;var Width  = 4;
		var boxHeight = 10;var boxWidth  = 20;
		
		//box2
		var bxpos2 = 25;var bypos2 = 4;	
		var ballFixture = new b2FixtureDef;var ballFixture2 = new b2FixtureDef;	
		var newBall;var newBall2;
		var boxDef = new b2BodyDef;
		var newBox;var boxFixture = new b2FixtureDef;
		var ballDef3 = new b2BodyDef;var ballFixture3 = new b2FixtureDef;var newBall3 = new Array();
		var jointDef_rear;var jointDef_front;
		var wallDefs = new Array({x:8.3,y:.03,w:36.7 ,h:.03}, //top
            {x:8.3,y:13.2,w:72.7 ,h:.03},   //bottom
            {x:3,y:6.67,w:.03 ,h:6.67}  //left
           //{x:36.7,y:6.67,w:.03 ,h:6.67}
		  );     //right
		var walls = new Array();
		var wallDef = new b2BodyDef;
		var newWall;var wallFixture = new b2FixtureDef;
		
		
		var xarr1=new Array();var yarr1=new Array();var xarr2=new Array();var yarr2=new Array();;var xarr3=new Array();var yarr3=new Array();
		var yat=Math.random()*.2;var kat=0.2;
		var totlines=550;var segments=totlines/55;
		var totlines2=550;var segments2=totlines2/55;
		var counter=0;var counter1=0;
		var addx=5;var addy=11;var addx1=5;var addy1=15;
		var iwallDef = new b2BodyDef;
		var newwall0;
		var newwall1;var iwallFixture = new b2FixtureDef;
		
		var boxDef2= new b2BodyDef;var boxFixture2 = new b2FixtureDef;
		var newBox2 = new Array();var fixed=new Array();
        var boxDef3 = new b2BodyDef;var newBox3 = new Array();var bridge=new Array();
        
		var newwall2=new Array();
		var newBox31= new Array(); 
		var setpos=780.3;
//images		
		var gas = new Image(); 
			gas.src = "gas.png";	
		var brake = new Image(); 
			brake.src = "brake.png";
		var bg = new Image(); 
			bg.src = "soil1.jpg";
		var bg1 = new Image(); 
			bg1.src = "soil2.jpg";
		var cul= new Image(); 
            cul.src = "redball.png";
		var img2 = new Image(); 
			img2.src = "car.png";
        var img3 = new Image(); 
			img3.src = "whee.png";
        var img4 = new Image(); 
			img4.src = "redball.png";
                   
		
		

//debug draw	
		var SCALE = 30;
		var debugDraw = new b2DebugDraw();
		debugDraw.SetSprite (context);
		debugDraw.SetDrawScale(30);     //define scale
		debugDraw.SetFillAlpha(0.3);    //define transparency
		debugDraw.SetLineThickness(1.0);
		debugDraw.SetFlags(b2DebugDraw.e_shapeBit | b2DebugDraw.e_jointBit);
		world.SetDebugDraw(debugDraw);
 
//Scrolling Screen
		document.onkeydown=function(e){
			e=e?e:window.event;
			keyPressList[e.keyCode]=true;
		}
		document.onkeyup=function(e){
			e=e?e:window.event;
			keyPressList[e.keyCode]=false;
		};
//camera
		var camera={};
		camera.dx=0;
		camera.dy=0;
//key presses
		var keyPressList={};
//in start		
	function init()
	{	
		ballDef.type = b2Body.b2_dynamicBody;
		ballDef2.type = b2Body.b2_dynamicBody;
		ballDef.position.Set(xpos, ypos);
		ballDef2.position.Set(xpos1, ypos1);
       
        ballFixture.density = 8;
        ballFixture.friction = 50;
        ballFixture.restitution = .5;
        ballFixture.shape =  new b2CircleShape(size);
		
		ballFixture2.density = 8;
        ballFixture2.friction = 50;
        ballFixture2.restitution = .5;
        ballFixture2.shape =  new b2CircleShape(size);
            
		newBall = world.CreateBody(ballDef)
		newBall2 = world.CreateBody(ballDef2)
		newBall.CreateFixture(ballFixture);
        newBall2.CreateFixture(ballFixture2);
		
		//body
        boxDef.type = b2Body.b2_dynamicBody;
        boxDef.position.Set(bxpos, bypos);
        boxFixture.density = 8*23;
        boxFixture.friction = 6;
		boxFixture.restitution = .1;
        boxFixture.shape = new b2PolygonShape;
        boxFixture.shape.SetAsBox((Width)/2,(Height)/2);
        newBox = world.CreateBody(boxDef);
		newBox.CreateFixture(boxFixture);
        newBox.SetUserData({width:Width,height:Height})
		
		
		//random stones
		ballDef3.type = b2Body.b2_dynamicBody;
		ballDef3.position.Set(Math.random()*265+15, 4);
        ballFixture3.density = 1.0;
        ballFixture3.friction = 0.5;
        ballFixture3.restitution = .5;
        ballFixture3.shape =  new b2CircleShape(.2);
		for (i = 0; i < 40; i++) 
		   {
			newBall3[i] = world.CreateBody(ballDef3);
			newBall3[i].CreateFixture(ballFixture3); 
           }

//Joint		
		jointDef_rear = new b2RevoluteJointDef();   
        jointDef_rear.Initialize(newBall,newBox, newBall.GetPosition());
        jointDef_rear.maxMotorTorque = 10.0;
        jointDef_rear.enableMotor = true;
		jointDef_rear.frequencyHz = 4.0;
        jointDef_rear.dampingRatio = -4.5;
		rear_joint = world.CreateJoint(jointDef_rear);

		jointDef_front = new b2RevoluteJointDef();
		jointDef_front.Initialize(newBox, newBall2, newBall2.GetPosition());
		jointDef_front.maxMotorTorque = 10.0;
		jointDef_front.enableMotor = true;
		jointDef_rear.frequencyHz = 4.0;
		jointDef_rear.dampingRatio = -4.5;
		front_joint = world.CreateJoint(jointDef_front);
	    
	
	  

		for (var i = 0; i <wallDefs.length; i++) 
		{
			wallDef.type = b2Body.b2_staticBody;
			wallDef.position.Set(wallDefs[i].x, wallDefs[i].y);
			newWall = world.CreateBody(wallDef);
			wallFixture.density = 10.0;
			wallFixture.friction = .2;
			wallFixture.restitution = .2;
			wallFixture.shape = new b2PolygonShape;
			wallFixture.shape.SetAsBox(wallDefs[i].w, wallDefs[i].h);
			newWall.CreateFixture(wallFixture);
			walls.push(newWall);
		}
  
     
 
   
//curve...
			
		for(var j=0;j<segments;j++)
		{
			if(j>0)
			{
				bool2=true;
				bool3=true;
			}
			for(var i=0;i<=55;i++)
			{
				if(bool2)
					{counter+=55;
					bool2=false;
				}
				if(i<25) 
				{ 
					if(bool3)
					{addx=xarr1[counter+i-1];
					addy=yarr1[counter+i-1];
					yat=.2;kat=.2;
					bool3=false;}
	
					xarr1[counter+i]=addx+kat;
					yarr1[counter+i]=addy-yat;
					bool4=true;   
				}
				else if(i>=25&&i<=27)
				{ 
					if(bool4)
					{	addx=xarr1[counter+i-1];
						addy=yarr1[counter+i-1];
						kat=.6;//yat=.2;
						bool4=false;
					} 
					xarr1[counter+i]=addx+kat;
					yarr1[counter+i]=yarr1[counter+i-1];
					bool1=true;
				}
				else                               
				{
					if(bool1)
					{var valx=xarr1[counter+i-1];
					var valy=yarr1[counter+i-1];
					yat=.2;kat=.6;
					bool1=false;}
	
					xarr1[counter+i]=valx+kat;
					yarr1[counter+i]=valy+yat;
				}
				kat+=.6;
				yat+=Math.random()*.2;
			}
		}
 

//2nd bezier
		counter=0;
		yat=.2; kat=0.2;
		for(var j=0;j<segments2;j++)
		{
			
			if(j==0)
			addy1=(yarr1[totlines2]-5.9+.5);
			if(j>0)
			{	
				bool2=true;
				bool3=true;
			}
			
			for(var i=0;i<=55;i++)
			{
		 
				if(bool2)
				{
					counter+=55;
					bool2=false;
				}
				if(i<25) 
				{ 
					if(bool3)
					{	
						addx1=xarr2[counter+i-1];
						addy1=yarr2[counter+i-1];
						yat=.2;kat=.2;
						bool3=false;
					}
					xarr2[counter+i]=addx1+kat;
					yarr2[counter+i]=addy1-yat;
					bool4=true;   
				}
				else if(i>=25&&i<=27)
				{ 
					if(bool4)
					{
						addx1=xarr2[counter+i-1];
						addy1=yarr2[counter+i-1];
						kat=.6;//yat=.2;
						bool4=false;
					} 
   
					xarr2[counter+i]=addx1+kat;
					yarr2[counter+i]=yarr2[counter+i-1];
					bool1=true;
				}
				else 
				{
					if(bool1)
					{
						var valx=xarr2[counter+i-1];
						var valy=yarr2[counter+i-1];
						yat=.2;kat=.6;
						bool1=false;
					}
  
					xarr2[counter+i]=valx+kat;
					yarr2[counter+i]=valy+yat;
				}
				kat+=.8; 
				yat+=Math.random()*.6;
				if(yat>7)
				yat-=Math.random()*.4;
				
			}
		} 
//3rd bezier
    addx1=5;addy1=10;
		counter=0;
		yat=.2; kat=0.2;
		for(var j=0;j<segments2;j++)
		{			
			if(j==segments2-1)
			addy1=10;
			if(j>0)
			{	
				bool2=true;
				bool3=true;
			}
			
			for(var i=0;i<=55;i++)
			{
				if(bool2)
				{
					counter+=55;
					bool2=false;
				}
				if(i<25) 
				{ 
					if(bool3)
					{	
						addx1=xarr3[counter+i-1];
						if(j==segments2-1)
						addy1=15;
						else
						addy1=yarr3[counter+i-1];
						yat=.2;kat=.2;
						bool3=false;
					}
					xarr3[counter+i]=addx1+kat;
					yarr3[counter+i]=addy1-yat;
					bool4=true;   
				}
				else if(i>=25&&i<=27)
				{ 
					if(bool4)
					{
						addx1=xarr3[counter+i-1];
						addy1=yarr3[counter+i-1];
						kat=.6;//yat=.2;
						bool4=false;
					} 
   
					xarr3[counter+i]=addx1+kat;
					yarr3[counter+i]=yarr3[counter+i-1];
					bool1=true;
				}
				else 
				{
					if(bool1)
					{
						var valx=xarr3[counter+i-1];
						var valy=yarr3[counter+i-1];
						yat=.2;kat=.6;
						bool1=false;
					}
  
					xarr3[counter+i]=valx+kat;
					yarr3[counter+i]=valy+yat;
				}
				kat+=.6; 
				if(j==segments2-1||j==0)
				yat+=.2;
				else
				{
				yat+=Math.random()*.6;
				if(yat>7)
				yat-=Math.random()*.4;
				}
			}
		}
//drawing initial easiest path
		for(var i=0;i<=totlines-1;i++)
		{
			iwallDef.type = b2Body.b2_staticBody;
			iwallDef.position.Set(-6,0);
			newwall1 = world.CreateBody(iwallDef)
			iwallFixture.density = 10.0;
			iwallFixture.friction = .2;
			iwallFixture.restitution = .2;
			iwallFixture.shape = new b2PolygonShape;
			iwallFixture.shape.SetAsArray([
			new b2Vec2(xarr1[i], yarr1[i]),
			new b2Vec2(xarr1[i+1], yarr1[i+1]),],2);
			newwall1.CreateFixture(iwallFixture);
	    }
   	
//bridge1
		boxDef2.type = b2Body.b2_staticBody;
        boxFixture2.density =1260;
        boxFixture2.friction = .5;
        boxFixture2.restitution = .1;
        boxFixture2.shape = new b2PolygonShape;
				
		var brx=xarr1[totlines]-90;
		var bry=yarr1[totlines];
				
		for (i = 0; i < 2; i++) 
		{
			boxDef2.position.Set(brx,bry);
			newBox2[i] = world.CreateBody(boxDef2)
			boxFixture2.shape.SetAsBox((boxWidth/SCALE)/2,(boxHeight/SCALE)/2);
			newBox2[i].CreateFixture(boxFixture2);
			newBox2[i].SetUserData({width:boxWidth/SCALE,height:boxHeight/SCALE})
			brx=365.3+90;
		}	   
       

	    boxDef3.type = b2Body.b2_dynamicBody;
        boxDef3.position.Set(bxpos2, bypos2);
		bxpos2=xarr1[totlines]-6;
		bypos2=yarr1[totlines];
		//bypos2=0;
		
		
		for (i = 0; i < 58; i++) 
		{
			boxDef3.position.Set(bxpos2, bypos2);
		    newBox3[i] = world.CreateBody(boxDef3);
			if(i<2)
			boxFixture2.shape.SetAsBox((boxWidth/SCALE)/2,(boxHeight/SCALE)/2);
			else
			boxFixture2.shape.SetAsBox((boxWidth/SCALE)/2,(boxHeight/SCALE)/2);
			newBox3[i].CreateFixture(boxFixture2);
			newBox3[i].SetUserData({width:boxWidth/SCALE,height:boxHeight/SCALE})
			bxpos2+=.8;
			bypos2-=.05;
			//if(i==57)
			//alert(bypos2+","+yarr3[totlines2]+","+yarr3[0]+","+(bypos2-yarr3[0])+","+(bypos2-yarr3[0]));
		}
		
//bridge joints
  	    fixed[0] = new b2RevoluteJointDef(); 
		fixed[0].Initialize(newBox2[0],newBox3[0], newBox3[0].GetPosition());
		fixed[0].maxMotorTorque = 1.0;
        fixed[0].enableMotor = true;
		fixed[0].frequencyHz = 4.0;
        fixed[0].dampingRatio = -4.5;
		fixed[0].enableLimit = true;
        
        rear_joint0 = world.CreateJoint(fixed[0]);

   
		for (i = 0; i < 57; i++) 
		{
			bridge[i] = new b2RevoluteJointDef();   
			bridge[i].Initialize(newBox3[i],newBox3[i+1], newBox3[i+1].GetPosition());
			bridge[i].maxMotorTorque = 1.0;
			bridge[i].enableMotor = true;
			bridge[i].frequencyHz = 4.0;
			bridge[i].dampingRatio = -4.5;
			bridge[i].enableLimit = true;
			rear_joint = world.CreateJoint(bridge[i]);
		} 
        
		fixed[1] = new b2RevoluteJointDef();  
		fixed[1].Initialize(newBox2[1],newBox3[57], newBox3[57].GetPosition());
		fixed[1].maxMotorTorque = 1.0;
        fixed[1].enableMotor = true;
		fixed[1].frequencyHz = 4.0;
        fixed[1].dampingRatio = -4.5;
		fixed[1].enableLimit = true;
        rear_joint1 = world.CreateJoint(fixed[1]);
		
		
		
		for(var i=0;i<=totlines2-1;i++)
			{
				//var iwallDef = new b2BodyDef;
				iwallDef.type = b2Body.b2_staticBody;
				iwallDef.position.Set(365.3,3);
				newwall0 = world.CreateBody(iwallDef)
				//var iwallFixture = new b2FixtureDef;
				iwallFixture.density = 10.0;
				iwallFixture.friction = .2;
				iwallFixture.restitution = .2;
				iwallFixture.shape = new b2PolygonShape;
				//alert(xarr2[i]+","+yarr2[i]+","+xarr3[i]+","+yarr3[i]);
				iwallFixture.shape.SetAsArray([
				new b2Vec2(xarr2[i], yarr2[i]),
				new b2Vec2(xarr2[i+1], yarr2[i+1]),],2);
				newwall0.CreateFixture(iwallFixture);		
			}
		}
function init2()
{

		for(var ti=0;ti<path;ti++)
		{ 
			for(var i=0;i<=totlines2-1;i++)
			{
				//var iwallDef = new b2BodyDef;
				iwallDef.type = b2Body.b2_staticBody;
				iwallDef.position.Set(setpos,3);
				newwall2[ti] = world.CreateBody(iwallDef);
				//var iwallFixture = new b2FixtureDef;
				iwallFixture.density = 10.0;
				iwallFixture.friction = .2;
				iwallFixture.restitution = .2;
				iwallFixture.shape = new b2PolygonShape;
				//alert(xarr2[i]+","+yarr2[i]+","+xarr3[i]+","+yarr3[i]);
				iwallFixture.shape.SetAsArray([
				new b2Vec2(xarr3[i], yarr3[i]),
				new b2Vec2(xarr3[i+1], yarr3[i+1]),],2);
				newwall2[ti].CreateFixture(iwallFixture);		
			}
			setpos+=372.3;
		}
//bridge
	
		for(var ti=0;ti<path;ti++)
		{ 
			var ps=newwall2[ti].GetPosition();
			//alert(ps.x);
			boxFixture2.density =260;
			boxFixture2.friction = .5;
			boxFixture2.restitution = .1;
			boxFixture2.shape = new b2PolygonShape;
			var brx=ps.x+xarr3[totlines2]-95;
			var bry=ps.y+yarr3[totlines2]-1;
			//alert(ps.y);		
			for (i = 0; i < 2; i++) 
			{
				boxDef2.position.Set(brx,bry);
				newBox2[i] = world.CreateBody(boxDef2)
				boxFixture2.shape.SetAsBox((boxWidth/SCALE)/2,(boxHeight/SCALE)/2);
				newBox2[i].CreateFixture(boxFixture2);
				newBox2[i].SetUserData({width:boxWidth/SCALE,height:boxHeight/SCALE})
				brx=400+ps.x+xarr2[0]+95;
				bry=1+ps.y+yarr2[0]+4;
			}	   
		
	    //var boxDef3 = new b2BodyDef;
        boxDef3.type = b2Body.b2_dynamicBody;
        boxDef3.position.Set(bxpos2, bypos2);
		newBox31[ti] = new Array();
		//var bridge=new Array();
		bxpos2=ps.x+xarr3[totlines2]-.1;
		bypos2=ps.y+yarr3[totlines2];
		//bypos2=0;
		
		for (i = 0; i < 58; i++) 
		{
			//alert(bxpos2+"cs");
			boxDef3.position.Set(bxpos2, bypos2);
			newBox31[ti][i] = world.CreateBody(boxDef3);
			if(i<2)
			boxFixture2.shape.SetAsBox((boxWidth/SCALE)/3,(boxHeight/SCALE)/3);
			else
			boxFixture2.shape.SetAsBox((boxWidth/SCALE)/2,(boxHeight/SCALE)/2);
			newBox31[ti][i].CreateFixture(boxFixture2);
			newBox31[ti][i].SetUserData({width:boxWidth/SCALE,height:boxHeight/SCALE})
			bxpos2+=.8;
			bypos2-=.1;
			}
		
    //bridge joints
		//	alert(xarr1[totlines]);
  	    fixed[0] = new b2RevoluteJointDef(); 
		fixed[0].Initialize(newBox2[0],newBox31[ti][0], newBox31[ti][0].GetPosition());
		fixed[0].maxMotorTorque = 1.0;
        fixed[0].enableMotor = true;
		fixed[0].frequencyHz = 4.0;
        fixed[0].dampingRatio = -4.5;
		fixed[0].enableLimit = true;
        
        rear_joint0 = world.CreateJoint(fixed[0]);

   
		for (i = 0; i < 57; i++) 
		{
			bridge[i] = new b2RevoluteJointDef();   
			bridge[i].Initialize(newBox31[ti][i],newBox31[ti][i+1], newBox31[ti][i+1].GetPosition());
			bridge[i].maxMotorTorque = 1.0;
			bridge[i].enableMotor = false;
			bridge[i].frequencyHz = 1.0;
			bridge[i].dampingRatio = -4.5;
			bridge[i].enableLimit = true;
            rear_joint = world.CreateJoint(bridge[i]);
		} 
		fixed[1] = new b2RevoluteJointDef();  
		fixed[1].Initialize(newBox2[1],newBox31[ti][57], newBox31[ti][57].GetPosition());
		fixed[1].maxMotorTorque = 1.0;
        fixed[1].enableMotor = true;
		fixed[1].frequencyHz = 1.0;
        fixed[1].dampingRatio = -4.5;
		fixed[1].enableLimit = true;
        rear_joint1 = world.CreateJoint(fixed[1]);
		}		
		
}
		function runGame() 
		{
			context.setTransform(1, 0, 0, 1, 0, 0);
			context.clearRect(0, 0, theCanvas.width, theCanvas.height);
			var pos = newBox.GetPosition(); 
			var atop=newBox.GetLinearVelocity();
			camera.dx = pos.x * SCALE-150;
			//camera.dy = pos.y * SCALE-150;
			context.translate(-camera.dx, -camera.dy);
		}
	  
 
		function gameLoop() 
		{
			window.setTimeout(gameLoop, 30);
			runGame();
			drawScreen();
			
	    }
		init();
		init2();
		gameLoop();

</script>



  
  